# 🎵 B站音频文件名一键清洗工具 (FixMusic.ps1)

## 📖 简介
这是一个专为 Bilibili 下载音频（如使用 BBDown 下载的文件）设计的 PowerShell 自动化整理脚本。
它能够智能识别并清洗文件名中常见的冗余信息（如 `[P1]`、`【MV】`、`(cover)`、歌手后缀等），将混乱的长文件名还原为干净的**歌名**。

**核心特点：** 采用纯 ASCII 编码编写，**彻底解决了 PowerShell 在不同系统语言环境下的中文乱码和语法报错问题**。

---

## 🚀 如何使用

1.  **放置脚本**：
    将 `FixMusic.ps1` 文件复制到存放音频文件（`.m4a`, `.mp3`, `.flac` 等）的文件夹中。
2.  **运行脚本**：
    *   **方法一（推荐）**：在文件夹空白处按住 `Shift` + `鼠标右键`，选择“在此处打开 PowerShell 窗口”，输入 `./FixMusic.ps1` 并回车。
    *   **方法二**：直接右键点击脚本文件，选择“使用 PowerShell 运行”。
3.  **等待完成**：
    脚本会自动扫描并重命名文件，完成后会自动退出。

---

## 🛠️ 功能逻辑详解

脚本按照以下优先级对文件名进行处理：

### 1. 预处理
*   **去除序号**：自动删除开头的 `[P1]`、`[P12]` 等分集序号。

### 2. 智能提取模式 (优先级最高)
如果文件名中包含以下符号，脚本会认为符号内的内容是**核心歌名**，直接提取，忽略其他杂质：
*   **书名号**：`《歌名》`
*   **直角引号**：`「歌名」` 或 `『歌名』`
*   **乱码修复**：自动识别并提取被乱码包围的文字（如 `??歌名??`）。

### 3. “剥洋葱”清洗模式 (当提取失败时)
如果没找到上述符号，脚本会执行清理逻辑：
*   **去头尾**：去除 B 站常见的标题前缀 `【...】`。
*   **去引用**：去除中文引号 `“...”` 及其后续内容。
*   **去后缀**：去除 `(cover)`、`（cover）` 以及 ` - 歌手名` 格式的后缀。

### 4. 最终净化
*   **去表情**：移除文件名中的闪电 `⚡`、爱心 `❤`、空心爱心 `♡` 等特殊符号。
*   **去标点**：去除首尾多余的空格、问号、下划线和短横线。

---

## 🛡️ 安全机制

*   **防重名**：如果重命名后的文件名已存在，脚本会自动添加后缀（如 `歌名_1.m4a`），**绝不会覆盖或删除您原本的文件**。
*   **防报错**：代码内部将所有中文字符转换为 `[char]` 数字编码，确保在任何 Windows 环境下都能稳定运行，不会出现“意外的标记”错误。

---

## 📝 示例

| 原文件名 | 清洗后文件名 |
| :--- | :--- |
| `[P1] 【翻唱】《七里香》 (cover 周杰伦) - 某某.m4a` | `七里香.m4a` |
| `[P3] 「Unravel」东京食尸鬼OP.flac` | `Unravel.flac` |
| `??Lemon??.mp3` (乱码情况) | `Lemon.mp3` |
| `【初音未来】 甩葱歌 (cover).m4a` | `甩葱歌.m4a` |
| `[P1] YOASOBI - Idol.mp4` | `偶像.mp4` |
